// package x

// import (
// 	"encoding/json"
// 	"fmt"
// 	"log"
// 	"os"
// 	"os/exec"
// 	"time"

// 	"github.com/getlantern/systray"
// 	"github.com/r3labs/sse/v2"
// )

// // Event Ø³Ø§Ø®ØªØ§Ø± Ø±ÙˆÛŒØ¯Ø§Ø¯ Ø¯Ø±ÛŒØ§ÙØªÛŒ Ø§Ø² Ø³Ø±ÙˆØ±
// type Event struct {
// 	Type    string `json:"type"`    // Ù†ÙˆØ¹ Ø±ÙˆÛŒØ¯Ø§Ø¯: "open_url", "notification", etc.
// 	URL     string `json:"url"`     // Ù„ÛŒÙ†Ú© Ø¨Ø±Ø§ÛŒ Ø¨Ø§Ø² Ú©Ø±Ø¯Ù†
// 	Message string `json:"message"` // Ù¾ÛŒØ§Ù… Ù†ÙˆØªÛŒÙÛŒÚ©ÛŒØ´Ù†
// 	Title   string `json:"title"`   // Ø¹Ù†ÙˆØ§Ù† Ù†ÙˆØªÛŒÙÛŒÚ©ÛŒØ´Ù†
// }

// // App Ø³Ø§Ø®ØªØ§Ø± Ø§ØµÙ„ÛŒ Ø¨Ø±Ù†Ø§Ù…Ù‡
// type App struct {
// 	sseClient     *sse.Client
// 	serverURL     string
// 	isConnected   bool
// 	menuConnected *systray.MenuItem
// 	menuStatus    *systray.MenuItem
// 	stopChan      chan bool
// }

// func main2() {
// 	// ØªÙ†Ø¸ÛŒÙ… Ù„Ø§Ú¯
// 	logFile, err := os.OpenFile("sse_tray.log", os.O_CREATE|os.O_WRONLY|os.O_APPEND, 0666)
// 	if err == nil {
// 		log.SetOutput(logFile)
// 		defer logFile.Close()
// 	}

// 	log.Println("Ø¨Ø±Ù†Ø§Ù…Ù‡ Ø¯Ø± Ø­Ø§Ù„ Ø´Ø±ÙˆØ¹...")
// 	systray.Run(onReady, onExit)
// }

// func onReady() {
// 	app := &App{
// 		serverURL: "http://localhost:8080/events", // Ø¢Ø¯Ø±Ø³ Ø³Ø±ÙˆØ± SSE
// 		stopChan:  make(chan bool),
// 	}

// 	// ØªÙ†Ø¸ÛŒÙ… Ø¢ÛŒÚ©ÙˆÙ† Ùˆ Ø¹Ù†ÙˆØ§Ù†
// 	systray.SetIcon(getIcon())
// 	systray.SetTitle("SSE Client")
// 	systray.SetTooltip("SSE Client - Ø¯Ø± Ø­Ø§Ù„ Ø§ØªØµØ§Ù„...")

// 	// Ø§ÛŒØ¬Ø§Ø¯ Ù…Ù†ÙˆÙ‡Ø§
// 	app.menuStatus = systray.AddMenuItem("ÙˆØ¶Ø¹ÛŒØª: Ø¯Ø± Ø­Ø§Ù„ Ø§ØªØµØ§Ù„...", "ÙˆØ¶Ø¹ÛŒØª ÙØ¹Ù„ÛŒ")
// 	app.menuStatus.Disable()

// 	systray.AddSeparator()

// 	app.menuConnected = systray.AddMenuItem("ğŸ”´ Ù‚Ø·Ø¹ Ø´Ø¯Ù‡", "ÙˆØ¶Ø¹ÛŒØª Ø§ØªØµØ§Ù„")
// 	app.menuConnected.Disable()

// 	mReconnect := systray.AddMenuItem("Ø§ØªØµØ§Ù„ Ù…Ø¬Ø¯Ø¯", "Ø§ØªØµØ§Ù„ Ù…Ø¬Ø¯Ø¯ Ø¨Ù‡ Ø³Ø±ÙˆØ±")
// 	mSettings := systray.AddMenuItem("ØªÙ†Ø¸ÛŒÙ…Ø§Øª", "ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø¨Ø±Ù†Ø§Ù…Ù‡")

// 	systray.AddSeparator()

// 	mAbout := systray.AddMenuItem("Ø¯Ø±Ø¨Ø§Ø±Ù‡", "Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ø¨Ø±Ù†Ø§Ù…Ù‡")
// 	mQuit := systray.AddMenuItem("Ø®Ø±ÙˆØ¬", "Ø®Ø±ÙˆØ¬ Ø§Ø² Ø¨Ø±Ù†Ø§Ù…Ù‡")

// 	// Ø´Ø±ÙˆØ¹ Ø§ØªØµØ§Ù„ SSE
// 	go app.connectSSE()

// 	// Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ù„ÛŒÚ©â€ŒÙ‡Ø§ÛŒ Ù…Ù†Ùˆ
// 	go func() {
// 		for {
// 			select {
// 			case <-mReconnect.ClickedCh:
// 				log.Println("Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø§ØªØµØ§Ù„ Ù…Ø¬Ø¯Ø¯...")
// 				app.reconnect()

// 			case <-mSettings.ClickedCh:
// 				log.Println("Ø¨Ø§Ø² Ú©Ø±Ø¯Ù† ØªÙ†Ø¸ÛŒÙ…Ø§Øª...")
// 				openBrowser("http://localhost:8080/settings")

// 			case <-mAbout.ClickedCh:
// 				log.Println("Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ø¨Ø±Ù†Ø§Ù…Ù‡")
// 				app.showAbout()

// 			case <-mQuit.ClickedCh:
// 				log.Println("Ø®Ø±ÙˆØ¬ Ø§Ø² Ø¨Ø±Ù†Ø§Ù…Ù‡...")
// 				app.stopChan <- true
// 				systray.Quit()
// 				return
// 			}
// 		}
// 	}()
// }

// func onExit() {
// 	log.Println("Ø¨Ø±Ù†Ø§Ù…Ù‡ Ø¨Ø³ØªÙ‡ Ø´Ø¯")
// }

// // connectSSE Ø§ØªØµØ§Ù„ Ø¨Ù‡ Ø³Ø±ÙˆØ± SSE
// func (app *App) connectSSE() {
// 	for {
// 		select {
// 		case <-app.stopChan:
// 			log.Println("Ø§ØªØµØ§Ù„ SSE Ù…ØªÙˆÙ‚Ù Ø´Ø¯")
// 			return
// 		default:
// 			app.tryConnect()
// 		}
// 	}
// }

// // tryConnect ØªÙ„Ø§Ø´ Ø¨Ø±Ø§ÛŒ Ø§ØªØµØ§Ù„
// func (app *App) tryConnect() {
// 	log.Printf("Ø¯Ø± Ø­Ø§Ù„ Ø§ØªØµØ§Ù„ Ø¨Ù‡ %s...\n", app.serverURL)
// 	app.updateStatus("Ø¯Ø± Ø­Ø§Ù„ Ø§ØªØµØ§Ù„...", false)

// 	// Ø§ÛŒØ¬Ø§Ø¯ Ú©Ù„Ø§ÛŒÙ†Øª SSE
// 	app.sseClient = sse.NewClient(app.serverURL)

// 	// ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø§ØªØµØ§Ù„
// 	// app.sseClient.ReconnectStrategy = &sse.BackoffStrategy{
// 	// 	MinRetryInterval: 1 * time.Second,
// 	// 	MaxRetryInterval: 30 * time.Second,
// 	// }

// 	// Subscribe Ø¨Ù‡ Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§
// 	err := app.sseClient.SubscribeRaw(func(msg *sse.Event) {
// 		app.handleEvent(msg)
// 	})

// 	if err != nil {
// 		log.Printf("Ø®Ø·Ø§ Ø¯Ø± Ø§ØªØµØ§Ù„: %v\n", err)
// 		app.updateStatus("Ø®Ø·Ø§ Ø¯Ø± Ø§ØªØµØ§Ù„", false)
// 		time.Sleep(5 * time.Second)
// 		return
// 	}
// }

// // handleEvent Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§ÛŒ Ø¯Ø±ÛŒØ§ÙØªÛŒ
// func (app *App) handleEvent(msg *sse.Event) {
// 	// Ø§ÙˆÙ„ÛŒÙ† Ø±ÙˆÛŒØ¯Ø§Ø¯ Ù…ÙˆÙÙ‚ ÛŒØ¹Ù†ÛŒ Ù…ØªØµÙ„ Ø´Ø¯ÛŒÙ…
// 	if !app.isConnected {
// 		app.updateStatus("Ù…ØªØµÙ„", true)
// 		log.Println("âœ… Ø§ØªØµØ§Ù„ Ø¨Ø±Ù‚Ø±Ø§Ø± Ø´Ø¯")
// 	}

// 	log.Printf("Ø±ÙˆÛŒØ¯Ø§Ø¯ Ø¯Ø±ÛŒØ§ÙØª Ø´Ø¯ - Ù†ÙˆØ¹: %s\n", string(msg.Event))
// 	log.Printf("Ø¯Ø§Ø¯Ù‡: %s\n", string(msg.Data))

// 	// Parse Ú©Ø±Ø¯Ù† JSON
// 	var event Event
// 	err := json.Unmarshal(msg.Data, &event)
// 	if err != nil {
// 		log.Printf("Ø®Ø·Ø§ Ø¯Ø± Parse Ø±ÙˆÛŒØ¯Ø§Ø¯: %v\n", err)
// 		return
// 	}

// 	// Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø¨Ø± Ø§Ø³Ø§Ø³ Ù†ÙˆØ¹ Ø±ÙˆÛŒØ¯Ø§Ø¯
// 	switch event.Type {
// 	case "open_url":
// 		app.handleOpenURL(event)

// 	case "notification":
// 		app.handleNotification(event)

// 	case "ping":
// 		log.Println("ğŸ’“ Ping Ø¯Ø±ÛŒØ§ÙØª Ø´Ø¯")

// 	default:
// 		log.Printf("Ù†ÙˆØ¹ Ø±ÙˆÛŒØ¯Ø§Ø¯ Ù†Ø§Ø´Ù†Ø§Ø®ØªÙ‡: %s\n", event.Type)
// 	}
// }

// // handleOpenURL Ø¨Ø§Ø² Ú©Ø±Ø¯Ù† URL Ø¯Ø± Ù…Ø±ÙˆØ±Ú¯Ø±
// func (app *App) handleOpenURL(event Event) {
// 	if event.URL == "" {
// 		log.Println("âš ï¸ URL Ø®Ø§Ù„ÛŒ Ø§Ø³Øª")
// 		return
// 	}

// 	log.Printf("ğŸŒ Ø¨Ø§Ø² Ú©Ø±Ø¯Ù† URL: %s\n", event.URL)

// 	err := openBrowser(event.URL)
// 	if err != nil {
// 		log.Printf("âŒ Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø² Ú©Ø±Ø¯Ù† URL: %v\n", err)
// 		app.showNotification("Ø®Ø·Ø§", fmt.Sprintf("Ù†ØªÙˆØ§Ù†Ø³ØªÙ… Ù„ÛŒÙ†Ú© Ø±Ø§ Ø¨Ø§Ø² Ú©Ù†Ù…: %s", event.URL))
// 	} else {
// 		log.Println("âœ… Ù„ÛŒÙ†Ú© Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ø§Ø² Ø´Ø¯")
// 		if event.Title != "" {
// 			app.showNotification(event.Title, "Ù„ÛŒÙ†Ú© Ø¯Ø± Ù…Ø±ÙˆØ±Ú¯Ø± Ø¨Ø§Ø² Ø´Ø¯")
// 		}
// 	}
// }

// // handleNotification Ù†Ù…Ø§ÛŒØ´ Ù†ÙˆØªÛŒÙÛŒÚ©ÛŒØ´Ù†
// func (app *App) handleNotification(event Event) {
// 	log.Printf("ğŸ”” Ù†ÙˆØªÛŒÙÛŒÚ©ÛŒØ´Ù†: %s - %s\n", event.Title, event.Message)
// 	app.showNotification(event.Title, event.Message)
// }

// // openBrowser Ø¨Ø§Ø² Ú©Ø±Ø¯Ù† Ù„ÛŒÙ†Ú© Ø¯Ø± Ù…Ø±ÙˆØ±Ú¯Ø± Ù¾ÛŒØ´â€ŒÙØ±Ø¶
// func openBrowser(url string) error {
// 	return exec.Command("rundll32", "url.dll,FileProtocolHandler", url).Start()
// }

// // updateStatus Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ÙˆØ¶Ø¹ÛŒØª Ø¯Ø± Ù…Ù†Ùˆ
// func (app *App) updateStatus(status string, connected bool) {
// 	app.isConnected = connected

// 	emoji := "ğŸ”´"
// 	if connected {
// 		emoji = "ğŸŸ¢"
// 	}

// 	app.menuStatus.SetTitle(fmt.Sprintf("ÙˆØ¶Ø¹ÛŒØª: %s", status))
// 	app.menuConnected.SetTitle(fmt.Sprintf("%s %s", emoji, status))

// 	tooltip := fmt.Sprintf("SSE Client - %s", status)
// 	systray.SetTooltip(tooltip)
// }

// // showNotification Ù†Ù…Ø§ÛŒØ´ Ù†ÙˆØªÛŒÙÛŒÚ©ÛŒØ´Ù†
// func (app *App) showNotification(title, message string) {
// 	tooltip := fmt.Sprintf("%s: %s", title, message)
// 	systray.SetTooltip(tooltip)
// 	log.Printf("ğŸ“¬ Notification: %s - %s\n", title, message)

// 	// Ø¨Ø±Ø§ÛŒ Ù†ÙˆØªÛŒÙÛŒÚ©ÛŒØ´Ù† ÙˆØ§Ù‚Ø¹ÛŒ ÙˆÛŒÙ†Ø¯ÙˆØ² Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø§Ø² toast Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯
// 	// go get github.com/go-toast/toast
// }

// // reconnect Ø§ØªØµØ§Ù„ Ù…Ø¬Ø¯Ø¯
// func (app *App) reconnect() {
// 	if app.sseClient != nil {
// 		app.sseClient.Unsubscribe(make(chan *sse.Event))
// 	}
// 	app.isConnected = false
// 	go app.connectSSE()
// }

// // showAbout Ù†Ù…Ø§ÛŒØ´ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¯Ø±Ø¨Ø§Ø±Ù‡
// func (app *App) showAbout() {
// 	log.Println("=== SSE Tray Client ===")
// 	log.Println("Version: 1.0.0")
// 	log.Printf("Server: %s\n", app.serverURL)
// 	log.Println("======================")
// }

// // getIcon Ø¢ÛŒÚ©ÙˆÙ† Ù¾ÛŒØ´â€ŒÙØ±Ø¶
// func getIcon() []byte {
// 	//file
// 	icon,_:=os.ReadFile("icons8-windows-tray-32.png")
// 	return icon
// 	ÛŒÚ© Ø¢ÛŒÚ©ÙˆÙ† Ø³Ø§Ø¯Ù‡ 16x16 PNG
// 	return []byte{
// 		0x89, 0x50, 0x4e, 0x47, 0x0d, 0x0a, 0x1a, 0x0a,
// 		0x00, 0x00, 0x00, 0x0d, 0x49, 0x48, 0x44, 0x52,
// 		0x00, 0x00, 0x00, 0x10, 0x00, 0x00, 0x00, 0x10,
// 		0x08, 0x06, 0x00, 0x00, 0x00, 0x1f, 0xf3, 0xff,
// 		0x61, 0x00, 0x00, 0x00, 0x19, 0x74, 0x45, 0x58,
// 		0x74, 0x53, 0x6f, 0x66, 0x74, 0x77, 0x61, 0x72,
// 		0x65, 0x00, 0x41, 0x64, 0x6f, 0x62, 0x65, 0x20,
// 		0x49, 0x6d, 0x61, 0x67, 0x65, 0x52, 0x65, 0x61,
// 		0x64, 0x79, 0x71, 0xc9, 0x65, 0x3c, 0x00, 0x00,
// 		0x00, 0x18, 0x49, 0x44, 0x41, 0x54, 0x78, 0xda,
// 		0x62, 0xfc, 0xff, 0xff, 0x3f, 0x03, 0x25, 0x00,
// 		0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x00, 0x0a,
// 		0x3b, 0x00, 0x01, 0x9b, 0x5d, 0x74, 0x2e, 0x00,
// 		0x00, 0x00, 0x00, 0x49, 0x45, 0x4e, 0x44, 0xae,
// 		0x42, 0x60, 0x82,
// 	}
//  }

